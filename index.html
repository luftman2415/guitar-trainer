<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Guitar Worship Trainer - Elite</title>
    <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1024 1024'%3E%3Cpath fill='%233498db' d='M480.5 176.6c-55.3 2.6-112.7 12.2-152.6 25.4-75.3 25-115.1 69.5-124 138.5-1.6 13.2-1.4 45.5.6 62 3.3 28.1 8 47.4 21.5 87 15 44.3 49.2 115.2 78.8 163.5 16.7 27.3 46.8 70.3 69.6 99.5 35.2 45.1 66.5 74.8 92.4 87.9 16.9 8.5 27 11 44.2 11 11.5 0 15-.4 23.5-2.7 26.6-7.3 52.2-25.1 81.4-56.7 19.7-21.4 31.1-35.6 62.2-77.5 49.5-66.8 99.3-162.1 123.8-236.8 11.2-34.2 15.6-53.8 18.2-81.2 1.4-15.5.6-52.4-1.5-64-8.7-48.7-33.7-84.6-76.6-109.7-38.4-22.5-98.8-37.8-174.5-44.3-17.4-1.5-70.7-2.6-87-1.9zm258.6 161.6 15.9 10.2-4.2 7.6c-14.8 27.2-38.8 60.2-65.7 90.3l-12.8 14.3 8.9 11c16.8 20.7 29.6 39.9 46.7 70.1l9.2 16.2-8.7 12.3c-4.8 6.8-10.5 14.7-12.7 17.7l-3.9 5.3-7.8-15c-14.1-27.1-30.3-53-48.8-77.9l-10.6-14.1-8 7.2c-40.8 36.1-86.4 59.4-133.3 67.8-18.3 3.2-50.3 3.3-67.8 0-24.1-4.5-46.1-12.1-66.4-22.8-36.3-19.2-64.5-44.3-95.1-84.5l-7.9-10.3 2.6-3.6c39.8-53.6 89.2-88.5 141-99.4 52.1-10.9 105.9-2.3 153.9 24.7 25.3 14.2 45.1 29.1 71.6 53.8l11.6 10.9 9.5-10.2c23.7-25.7 40.1-47.7 57.7-77.7 4.5-7.7 8.5-14.1 8.7-14.1.3 0 7.7 4.6 16.4 10.2z'/%3E%3Cpath d='M424.6 379.1c-28 4.9-56.6 18.3-80.3 37.5-8.7 7.1-29.3 27.7-29.3 29.3 0 1.3 25.8 26.1 34.3 33 19.1 15.5 43.5 29.3 63.6 36 47.9 15.9 101.3 9.8 149.3-17 16.7-9.4 38.7-25.1 52.3-37.3l4-3.6-8.5-8.1c-42.3-40.4-85.3-63.8-129.4-70.4-14.8-2.2-42-1.9-56 .6z'/%3E%3C/svg%3E">
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        :root { --bg-primary: #ffffff; --bg-secondary: #f8f9fa; --bg-card: #ffffff; --text-primary: #2c3e50; --text-secondary: #6c757d; --accent-primary: #3498db; --accent-secondary: #e74c3c; --border-color: #dee2e6; --shadow: 0 4px 6px rgba(0, 0, 0, 0.1); --shadow-hover: 0 8px 15px rgba(0, 0, 0, 0.15); --success-color: #27ae60; --error-color: #e74c3c; --warning-color: #f39c12; }
        [data-theme="dark"] { --bg-primary: #1a1a1a; --bg-secondary: #2d2d2d; --bg-card: #363636; --text-primary: #ffffff; --text-secondary: #b0b0b0; --accent-primary: #4a9eff; --accent-secondary: #ff6b6b; --border-color: #4a4a4a; --shadow: 0 4px 6px rgba(0, 0, 0, 0.3); --shadow-hover: 0 8px 15px rgba(0, 0, 0, 0.4); --success-color: #2ecc71; --error-color: #ff6b6b; --warning-color: #f1c40f; }
        [data-theme="ocean"] { --bg-primary: #0f172a; --bg-secondary: #1e293b; --bg-card: #334155; --text-primary: #f1f5f9; --text-secondary: #94a3b8; --accent-primary: #06b6d4; --accent-secondary: #0ea5e9; --border-color: #475569; --shadow: 0 4px 6px rgba(6, 182, 212, 0.2); --shadow-hover: 0 8px 15px rgba(6, 182, 212, 0.3); --success-color: #10b981; --error-color: #ef4444; --warning-color: #f59e0b; }
        [data-theme="forest"] { --bg-primary: #0f1b0f; --bg-secondary: #1a2e1a; --bg-card: #2d4a2d; --text-primary: #f0f9f0; --text-secondary: #9bb59b; --accent-primary: #22c55e; --accent-secondary: #16a34a; --border-color: #4a6741; --shadow: 0 4px 6px rgba(34, 197, 94, 0.2); --shadow-hover: 0 8px 15px rgba(34, 197, 94, 0.3); --success-color: #22c55e; --error-color: #ef4444; --warning-color: #eab308; }
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Montserrat', sans-serif; background-color: var(--bg-primary); color: var(--text-primary); transition: background-color 0.3s ease, color 0.3s ease; line-height: 1.6; }
        body.loading, body.loading * { cursor: wait !important; }
        .main { max-width: 1200px; margin: 0 auto; padding: 2rem; min-height: calc(100vh - 250px); }
        .section { display: none; animation: fadeIn 0.3s ease-in-out; }
        .section.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        .header { background-color: var(--bg-secondary); padding: 1rem 2rem; box-shadow: var(--shadow); position: sticky; top: 0; z-index: 1000; border-bottom: 1px solid var(--border-color); }
        .header-content { display: flex; justify-content: space-between; align-items: center; max-width: 1200px; margin: 0 auto; }
        .logo { display: flex; align-items: center; gap: 0.75rem; font-size: 1.5rem; font-weight: 700; color: var(--accent-primary); transition: color 0.3s ease; }
        .logo svg { fill: currentColor; height: 35px; width: auto; }
        .theme-switcher { display: flex; gap: 0.5rem; }
        .nav { background-color: var(--bg-card); padding: 1rem 2rem; border-bottom: 1px solid var(--border-color); }
        .nav-content { max-width: 1200px; margin: 0 auto; display: flex; gap: 0.5rem; flex-wrap: wrap; justify-content: center; }
        
        .button, .styled-select { display: inline-flex; align-items: center; justify-content: center; gap: 0.5em; padding: 0.75rem 1.5rem; border-radius: 25px; cursor: pointer; font-family: 'Montserrat', sans-serif; font-weight: 500; transition: all 0.2s ease; border: 2px solid var(--border-color); }
        .button:active, .styled-select:active { transform: scale(0.98); }
        .nav-btn:hover { border-color: var(--accent-primary); color: var(--accent-primary); }
        .nav-btn.active { background: var(--accent-primary); border-color: var(--accent-primary); color: white; }
        .btn-primary { background: var(--accent-primary); color: white; border-color: var(--accent-primary); }
        .btn-primary:hover { filter: brightness(1.1); }
        .btn-secondary { background: var(--bg-secondary); color: var(--text-primary); border-color: var(--border-color); }
        .btn-secondary:hover { background: var(--border-color); }
        .exercise-btn { border-radius: 8px; }
        .exercise-btn:hover { background: var(--accent-primary); color: white; }
        .exercise-btn.correct { background: var(--success-color); border-color: var(--success-color); color: white; }
        .exercise-btn.incorrect { background: var(--error-color); border-color: var(--error-color); color: white; }

        .welcome { text-align: center; margin-bottom: 3rem; }
        .welcome h1 { font-size: 2.5rem; margin-bottom: 1rem; color: var(--accent-primary); }
        .cards-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 2rem; margin-top: 2rem; }
        .card { background: var(--bg-card); border: 1px solid var(--border-color); border-radius: 12px; padding: 2rem; text-align: center; cursor: pointer; transition: all 0.2s ease; box-shadow: var(--shadow); }
        .card:hover { transform: translateY(-5px); box-shadow: var(--shadow-hover); }
        .card-icon { font-size: 3rem; margin-bottom: 1rem; }
        .card h3 { color: var(--accent-primary); }

        .metronome-controls { max-width: 600px; margin: 0 auto; text-align: center; }
        .bpm-display { font-size: 4rem; font-weight: 700; color: var(--accent-primary); margin-bottom: 1rem; }
        .control-group { margin-bottom: 1.5rem; }
        .control-group label { display: block; margin-bottom: 0.5rem; font-weight: 500; }
        .visual-indicator { width: 100px; height: 100px; border-radius: 50%; border: 4px solid var(--border-color); margin: 1rem auto 2rem; transition: all 0.1s ease; display: flex; justify-content: center; align-items: center; background-color: var(--bg-card); }
        .visual-indicator.beat { border-color: var(--accent-primary); background: var(--accent-primary); transform: scale(1.1); }
        .strum-arrow { width: 0; height: 0; border-left: 20px solid transparent; border-right: 20px solid transparent; transition: transform 0.1s ease, border-color 0.1s ease; }
        .strum-arrow.down { border-top: 30px solid var(--text-secondary); }
        .strum-arrow.up { border-bottom: 30px solid var(--text-secondary); }
        .strum-arrow.active { transform: scale(1.2); }
        .strum-arrow.active.down { border-top-color: var(--accent-primary); }
        .strum-arrow.active.up { border-bottom-color: var(--accent-primary); }
        
        .tabs { display: flex; border-bottom: 2px solid var(--border-color); margin-bottom: 2rem; gap: 1rem; }
        .tab { background: transparent; border: none; color: var(--text-secondary); padding: 1rem 1.5rem; cursor: pointer; font-weight: 500; border-bottom: 2px solid transparent; transition: all 0.2s ease; }
        .tab:hover { color: var(--accent-primary); }
        .tab.active { color: var(--accent-primary); border-bottom-color: var(--accent-primary); }
        .tab-content { display: none; } .tab-content.active { display: block; }
        
        .song-manager { max-width: 800px; margin: 0 auto; }
        .song-controls { display: flex; gap: 1rem; margin-bottom: 2rem; flex-wrap: wrap; align-items: center; }
        .song-selector { flex: 1; min-width: 200px; }
        .song-display { background: var(--bg-card); border: 1px solid var(--border-color); border-radius: 12px; padding: 2rem; margin-bottom: 2rem; }
        .song-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; flex-wrap: wrap; gap: 1rem; }
        .song-actions { display: flex; gap: 0.5rem; align-items: center;}
        .transpose-controls { display: flex; gap: 0.5rem; }
        .transpose-btn, #deleteSongBtn { padding: 0.5rem 1rem; border-radius: 6px; font-size: 0.9rem; }
        #deleteSongBtn { background: var(--error-color); color: white; border-color: var(--error-color); }
        .song-structure { font-family: 'Courier New', monospace; white-space: pre-wrap; line-height: 2.2; font-size: 1rem; }
        .song-structure .chord { font-weight: bold; color: var(--accent-primary); cursor: pointer; position: relative; background: var(--bg-secondary); padding: 0.1em 0.3em; border-radius: 4px; }
        .section-title { display: flex; align-items: center; gap: 0.5rem; margin-top: 1rem;}
        .section-loop-btn { font-size: 1rem; cursor: pointer; transition: transform 0.4s ease, color 0.2s ease; padding: 0.2rem; border-radius: 50%; }
        .section-loop-btn:hover { background: var(--bg-secondary); }
        .section-loop-btn.looping { color: var(--accent-primary); transform: rotate(360deg); }
        .empty-state { text-align: center; padding: 3rem; background-color: var(--bg-secondary); border-radius: 12px; border: 2px dashed var(--border-color); }
        
        #chordTooltip { position: absolute; display: none; background: var(--bg-card); border: 1px solid var(--border-color); border-radius: 8px; box-shadow: var(--shadow-hover); z-index: 1001; padding: 0.5rem; pointer-events: none; transition: opacity 0.2s; }
        #chordTooltip.visible { display: block; opacity: 1; }
        .fretboard-tooltip { display: inline-block; padding: 0.5rem; background: var(--bg-card); border-radius: 6px;}
        .fretboard-tooltip .chord-name { font-size: 0.8rem; font-weight: bold; text-align: center; margin-bottom: 4px; }
        .fret-tooltip { display: flex; position: relative; width: 60px; height: 10px; border-bottom: 1px solid var(--text-secondary); }
        .fret-tooltip:first-child { border-top: 2px solid var(--text-primary); }
        .string-tooltip { position: absolute; width: 1px; height: 100%; background: var(--text-secondary); }
        .finger-tooltip { width: 8px; height: 8px; background: var(--accent-primary); border-radius: 50%; position: absolute; transform: translate(-50%, -50%); }
        .open-string-tooltip { width: 8px; height: 8px; border-radius: 50%; border: 1px solid var(--accent-primary); position: absolute; transform: translate(-50%, -50%); top: -5px;}
        .muted-string-tooltip { position: absolute; transform: translate(-50%, -50%); top: -4px; font-size: 12px; font-weight: bold; color: var(--error-color);}

        .scales-controls { display: flex; justify-content: center; gap: 1rem; margin-bottom: 2rem; flex-wrap: wrap; }
        #fretboardVisualizer { background: var(--bg-card); border-radius: 8px; padding: 1.5rem 1rem; overflow-x: auto; border: 1px solid var(--border-color); margin-top: 2rem; }
        .fretboard-grid { display: grid; grid-template-columns: 50px repeat(13, 1fr); min-width: 800px; gap: 4px; }
        .string-label, .fret-number-label { display: flex; justify-content: center; align-items: center; font-weight: bold; font-size: 0.8rem; }
        .fret-cell { height: 35px; border-left: 1px solid var(--border-color); position: relative; display: flex; justify-content: center; align-items: center; }
        .fret-number-label { background: var(--bg-secondary); border-radius: 4px; }
        .fret-number-label::after { content: ''; position: absolute; top: 100%; left: 50%; transform: translateX(-50%); height: 10px; width: 2px; background-color: var(--border-color); }
        .fret-number-label.fret-marker::after { content: '●'; background: none; color: var(--text-secondary); font-size: 0.7rem; }
        .fret-number-label.fret-marker-double::after { content: '● ●'; background: none; color: var(--text-secondary); font-size: 0.7rem; letter-spacing: 0.5rem; }
        .note-dot { width: 24px; height: 24px; border-radius: 50%; display: flex; justify-content: center; align-items: center; color: white; font-weight: bold; }
        .note-dot.root-note { background-color: var(--accent-primary); }
        .note-dot.scale-note { background-color: var(--success-color); }
        
        .memory-game-container { text-align: center; }
        #memorySequenceDisplay { font-size: 2rem; font-weight: bold; color: var(--accent-primary); min-height: 50px; margin: 2rem 0; }
        #memoryOptionsContainer .exercise-btn { width: 100px; }
        #memoryResult { margin-top: 1rem; font-size: 1.2rem; font-weight: 600; }
        footer { background: var(--bg-secondary); border-top: 1px solid var(--border-color); padding: 2rem; text-align: center; color: var(--text-secondary); margin-top: 3rem; }
        .styled-select { -webkit-appearance: none; appearance: none; background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e"); background-position: right 0.5rem center; background-repeat: no-repeat; background-size: 1.5em 1.5em; padding-right: 2.5rem; }
    </style>
</head>
<body data-theme="light">
    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <div class="logo">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1024 1024"><path d="M480.5 176.6c-55.3 2.6-112.7 12.2-152.6 25.4-75.3 25-115.1 69.5-124 138.5-1.6 13.2-1.4 45.5.6 62 3.3 28.1 8 47.4 21.5 87 15 44.3 49.2 115.2 78.8 163.5 16.7 27.3 46.8 70.3 69.6 99.5 35.2 45.1 66.5 74.8 92.4 87.9 16.9 8.5 27 11 44.2 11 11.5 0 15-.4 23.5-2.7 26.6-7.3 52.2-25.1 81.4-56.7 19.7-21.4 31.1-35.6 62.2-77.5 49.5-66.8 99.3-162.1 123.8-236.8 11.2-34.2 15.6-53.8 18.2-81.2 1.4-15.5.6-52.4-1.5-64-8.7-48.7-33.7-84.6-76.6-109.7-38.4-22.5-98.8-37.8-174.5-44.3-17.4-1.5-70.7-2.6-87-1.9zm258.6 161.6 15.9 10.2-4.2 7.6c-14.8 27.2-38.8 60.2-65.7 90.3l-12.8 14.3 8.9 11c16.8 20.7 29.6 39.9 46.7 70.1l9.2 16.2-8.7 12.3c-4.8 6.8-10.5 14.7-12.7 17.7l-3.9 5.3-7.8-15c-14.1-27.1-30.3-53-48.8-77.9l-10.6-14.1-8 7.2c-40.8 36.1-86.4 59.4-133.3 67.8-18.3 3.2-50.3 3.3-67.8 0-24.1-4.5-46.1-12.1-66.4-22.8-36.3-19.2-64.5-44.3-95.1-84.5l-7.9-10.3 2.6-3.6c39.8-53.6 89.2-88.5 141-99.4 52.1-10.9 105.9-2.3 153.9 24.7 25.3 14.2 45.1 29.1 71.6 53.8l11.6 10.9 9.5-10.2c23.7-25.7 40.1-47.7 57.7-77.7 4.5-7.7 8.5-14.1 8.7-14.1.3 0 7.7 4.6 16.4 10.2z"/><path d="M424.6 379.1c-28 4.9-56.6 18.3-80.3 37.5-8.7 7.1-29.3 27.7-29.3 29.3 0 1.3 25.8 26.1 34.3 33 19.1 15.5 43.5 29.3 63.6 36 47.9 15.9 101.3 9.8 149.3-17 16.7-9.4 38.7-25.1 52.3-37.3l4-3.6-8.5-8.1c-42.3-40.4-85.3-63.8-129.4-70.4-14.8-2.2-42-1.9-56 .6z"/></svg>
                <span>Guitar Worship Trainer</span>
            </div>
            <div class="theme-switcher">
                <button class="theme-btn button" data-theme="light" title="Tema Claro">☀️</button>
                <button class="theme-btn button" data-theme="dark" title="Tema Oscuro">🌙</button>
                <button class="theme-btn button" data-theme="ocean" title="Tema Océano">🌊</button>
                <button class="theme-btn button" data-theme="forest" title="Tema Bosque">🌲</button>
            </div>
        </div>
    </header>

    <nav class="nav">
        <div class="nav-content">
            <button class="nav-btn button active" data-section="inicio">🏠 Inicio</button>
            <button class="nav-btn button" data-section="metronome">🥁 Metrónomo</button>
            <button class="nav-btn button" data-section="ear-training">👂 Oído Musical</button>
            <button class="nav-btn button" data-section="songs">🎵 Canciones</button>
            <button class="nav-btn button" data-section="scales">🎸 Escalas</button>
            <button class="nav-btn button" data-section="memory">🧠 Memoria</button>
        </div>
    </nav>

    <main class="main">
        <section id="inicio" class="section active">
            <div class="welcome">
                <h1>Bienvenido a Guitar Worship Trainer</h1>
                <p>Tu herramienta todo-en-uno para mejorar tus habilidades como músico de adoración.</p>
            </div>
            <div class="cards-grid">
                <div class="card" data-section="metronome"><div class="card-icon">🥁</div><h3>Metrónomo Pro</h3><p>Practica con subdivisiones, patrones de rasgueo y Tap Tempo.</p></div>
                <div class="card" data-section="ear-training"><div class="card-icon">👂</div><h3>Oído Musical</h3><p>Entrena intervalos, acordes y progresiones armónicas.</p></div>
                <div class="card" data-section="songs"><div class="card-icon">🎵</div><h3>Canciones Pro</h3><p>Transporta canciones y visualiza acordes al instante.</p></div>
                <div class="card" data-section="scales"><div class="card-icon">🎸</div><h3>Visualizador de Escalas</h3><p>Aprende cualquier escala en todo el diapasón.</p></div>
                <div class="card" data-section="memory"><div class="card-icon">🧠</div><h3>Memoria Musical</h3><p>Fortalece tu memoria con nuestro juego interactivo de secuencias.</p></div>
            </div>
        </section>

        <section id="metronome" class="section">
            <div class="metronome-controls">
                <div class="bpm-display" id="bpmDisplay">120</div>
                <div class="visual-indicator" id="visualIndicator"></div>
                <div class="control-group">
                    <label for="bpmSlider">Tempo (BPM)</label>
                    <input type="range" id="bpmSlider" min="40" max="240" value="120">
                </div>
                <div class="control-group">
                    <label for="timeSignature">Compás</label>
                    <select id="timeSignature" class="styled-select"><option value="4/4">4/4</option><option value="3/4">3/4</option><option value="2/4">2/4</option><option value="6/8">6/8</option></select>
                </div>
                <div class="control-group">
                    <label for="subdivisionSelect">Subdivisiones</label>
                    <select id="subdivisionSelect" class="styled-select"><option value="1">Negra (1/4)</option><option value="2">Corchea (1/8)</option><option value="4">Semicorchea (1/16)</option></select>
                </div>
                <div class="control-group">
                    <label for="strumPatternSelect">Patrón de Rasgueo</label>
                    <select id="strumPatternSelect" class="styled-select"><option value="">-- Sin Patrón --</option><option value="basic">Básico (↓ ↓↑ ↑↓↑)</option><option value="ballad">Balada (↓ ↑↑ ↓↑↑)</option></select>
                </div>
                <div class="control-group">
                    <button id="playBtn" class="play-btn button">▶️ Iniciar</button>
                    <button id="tapTempoBtn" class="button">Tap</button>
                </div>
            </div>
        </section>

        <section id="ear-training" class="section">
            <div class="instrument-selector">
                <label for="instrumentSelect">Selecciona el Instrumento:</label>
                <select id="instrumentSelect" class="styled-select"><option value="piano">🎹 Piano</option><option value="guitar">🎸 Guitarra</option><option value="bass">🎸 Bajo</option></select>
            </div>
            <div class="tabs">
                <button class="tab active" data-tab="intervals">Intervalos</button>
                <button class="tab" data-tab="chords">Acordes</button>
                <button class="tab" data-tab="progressions">Progresiones</button>
            </div>
            <div id="intervals" class="tab-content active">
                <h2>Entrenamiento de Intervalos</h2>
                <div class="exercise-controls"><button class="exercise-btn button" id="newInterval">🎵 Nuevo Intervalo</button><button class="exercise-btn button" id="repeatInterval">🔄 Repetir</button></div>
                <div id="intervalOptions" class="exercise-controls" style="display: none;"></div><div id="intervalResult" style="margin-top: 1rem; font-size: 1.2rem; font-weight: 600;"></div>
            </div>
            <div id="chords" class="tab-content">
                <h2>Entrenamiento de Acordes</h2>
                <div class="exercise-controls"><button class="exercise-btn button" id="newChord">🎹 Nuevo Acorde</button><button class="exercise-btn button" id="repeatChord">🔄 Repetir</button></div>
                <div id="chordOptions" class="exercise-controls" style="display: none;"></div><div id="chordResult" style="margin-top: 1rem; font-size: 1.2rem; font-weight: 600;"></div>
            </div>
            <div id="progressions" class="tab-content">
                <h2>Entrenamiento de Progresiones</h2>
                <div class="exercise-controls"><button class="exercise-btn button" id="newProgression">🎼 Nueva Progresión</button><button class="exercise-btn button" id="repeatProgression">🔄 Repetir</button></div>
                <div id="progressionOptions" class="exercise-controls" style="display: none;"></div><div id="progressionResult" style="margin-top: 1rem; font-size: 1.2rem; font-weight: 600;"></div>
            </div>
        </section>
        
        <section id="songs" class="section">
            <div class="song-manager">
                <h1>🎵 Gestor de Canciones</h1>
                <p style="margin-bottom: 2rem; color: var(--text-secondary);">Gestiona, transporta y visualiza los acordes de tu repertorio.</p>
                <div class="song-controls">
                    <div class="song-selector"><select id="songSelect" class="styled-select"><option value="">Selecciona una canción...</option></select></div>
                    <button class="btn-primary button" id="addSongBtn">➕ Añadir</button>
                    <button class="btn-secondary button" id="importSongsBtn">📥 Importar</button>
                    <button class="btn-secondary button" id="exportSongsBtn">📤 Exportar</button>
                </div>
                <div id="songEmptyState" class="empty-state" style="display: none;">
                    <h3>No hay canciones en tu repertorio</h3>
                    <p>¡Añade tu primera canción o importa una lista para empezar a practicar!</p>
                </div>
                <div id="songDisplay" class="song-display" style="display: none;">
                    <div class="song-header">
                        <div>
                            <h2 id="currentSongTitle"></h2>
                            <p id="currentSongArtist" style="color: var(--text-secondary);"></p>
                        </div>
                        <div class="song-actions">
                            <div class="transpose-controls">
                                <button class="transpose-btn button" id="transposeDown">-1</button>
                                <button class="transpose-btn button" id="transposeUp">+1</button>
                            </div>
                            <button id="deleteSongBtn" class="button" style="display: none;">🗑️</button>
                        </div>
                    </div>
                    <div id="songStructure" class="song-structure"></div>
                </div>
            </div>
        </section>
        
        <section id="scales" class="section">
            <h1 style="text-align:center;">Visualizador de Escalas</h1>
            <div class="scales-controls">
                <select id="rootNoteSelect" class="styled-select">
                    <option value="C">C</option><option value="C#">C# / Db</option><option value="D">D</option><option value="D#">D# / Eb</option><option value="E">E</option><option value="F">F</option><option value="F#">F# / Gb</option><option value="G">G</option><option value="G#">G# / Ab</option><option value="A">A</option><option value="A#">A# / Bb</option><option value="B">B</option>
                </select>
                <select id="scaleTypeSelect" class="styled-select">
                    <option value="major">Mayor</option><option value="minor">menor Natural</option><option value="pentatonic-major">Pentatónica Mayor</option><option value="pentatonic-minor">Pentatónica menor</option>
                </select>
            </div>
            <div id="fretboardVisualizer"></div>
        </section>

        <section id="memory" class="section">
            <div class="memory-game-container">
                <h1>🧠 Juego de Memoria Musical</h1>
                <p style="color: var(--text-secondary); margin-bottom: 2rem;">Repite la secuencia de acordes. ¡Cada nivel es más difícil!</p>
                <div id="memorySequenceDisplay">Pulsa "Iniciar" para empezar</div>
                <div id="memoryOptionsContainer" class="exercise-controls"></div>
                <div id="memoryResult"></div>
                <div class="exercise-controls">
                    <button class="btn-primary button" id="startMemoryGameBtn">▶️ Iniciar Juego</button>
                </div>
            </div>
        </section>
    </main>
    
    <input type="file" id="fileInput" accept=".json" style="display: none;">
    <div id="chordTooltip"></div>
    <footer><p>Copyright © <span id="copyright-year"></span> LUFTMANDMAURICIO</p></footer>

<script>
// =================================================================================
// CLASE PRINCIPAL DE LA APLICACIÓN
// =================================================================================
class GuitarWorshipTrainer {
    constructor() {
        this.currentSection = 'inicio';
        this.themeManager = new ThemeManager();
        this.earTraining = new EarTraining();
        this.scaleVisualizer = new ScaleVisualizer();
        this.songManager = new SongManager(this.earTraining); // Pasar referencia
        this.memoryGame = new MemoryGame(this.earTraining); // Pasar referencia
        this.metronome = new Metronome();
        this.init();
    }

    init() {
        this.setupNavigation();
        this.setupThemeSwitcher();
        this.setupCardNavigation();
        this.setupKeyboardShortcuts();
        this.setupCopyright();
        this.themeManager.loadSavedTheme();
    }

    setupNavigation() {
        document.querySelectorAll('.nav-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                this.showSection(btn.dataset.section);
            });
        });
    }

    setupCardNavigation() {
        document.querySelectorAll('.card[data-section]').forEach(card => {
            card.addEventListener('click', () => {
                this.showSection(card.dataset.section);
            });
        });
    }

    setupThemeSwitcher() {
        document.querySelectorAll('.theme-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                this.themeManager.setTheme(btn.dataset.theme);
                this.updateActiveThemeButton(btn);
            });
        });
    }

    setupKeyboardShortcuts() {
        document.addEventListener('keydown', e => {
            if (['INPUT', 'TEXTAREA'].includes(e.target.tagName)) return;
            if (this.currentSection === 'metronome' && e.code === 'Space') {
                e.preventDefault();
                this.metronome.togglePlay();
            }
             if (this.currentSection === 'ear-training') {
                if (e.code === 'KeyN') { e.preventDefault(); this.earTraining.triggerNewExercise(); }
                if (e.code === 'KeyR') { e.preventDefault(); this.earTraining.triggerRepeatExercise(); }
            }
        });
    }

    setupCopyright() {
        document.getElementById('copyright-year').textContent = new Date().getFullYear();
    }

    showSection(sectionId) {
        this.currentSection = sectionId;
        document.querySelectorAll('.section').forEach(s => s.classList.toggle('active', s.id === sectionId));
        document.querySelectorAll('.nav-btn').forEach(b => b.classList.toggle('active', b.dataset.section === sectionId));

        if (sectionId !== 'metronome' && this.metronome.isPlaying) this.metronome.stop();
        if (sectionId === 'scales') this.scaleVisualizer.render();
    }

    updateActiveThemeButton(activeBtn) {
        document.querySelectorAll('.theme-btn').forEach(btn => btn.classList.remove('active'));
        activeBtn.classList.add('active');
    }
}

// =================================================================================
// GESTOR DE TEMAS
// =================================================================================
class ThemeManager {
    setTheme(theme) { document.body.setAttribute('data-theme', theme); localStorage.setItem('gwt-theme', theme); }
    loadSavedTheme() {
        const savedTheme = localStorage.getItem('gwt-theme') || 'light';
        this.setTheme(savedTheme);
        document.querySelectorAll('.theme-btn').forEach(btn => {
            btn.classList.toggle('active', btn.dataset.theme === savedTheme);
        });
    }
}

// =================================================================================
// METRÓNOMO PRO
// =================================================================================
class Metronome {
    constructor() {
        this.audioContext = null; this.isPlaying = false;
        this.bpm = 120; this.timeSignature = '4/4'; this.subdivision = 1; this.strumPattern = '';
        this.currentBeat = 0; this.currentSubdivision = 0; this.nextNoteTime = 0;
        this.timerID = null; this.lookahead = 25; this.scheduleAheadTime = 0.1;
        this.tapTimes = [];
        this.strumPatterns = { 'basic': ['↓', '↓', '↑', '↑', '↓', '↑'], 'ballad': ['↓', '↑', '↑', '↓', '↑', '↑'] };
        this.setupControls();
        this.loadSettings();
    }
    setupControls() {
        this.bpmSlider = document.getElementById('bpmSlider');
        this.bpmDisplay = document.getElementById('bpmDisplay');
        this.playBtn = document.getElementById('playBtn');
        this.timeSignatureSelect = document.getElementById('timeSignature');
        this.subdivisionSelect = document.getElementById('subdivisionSelect');
        
        this.bpmSlider.addEventListener('input', e => this.setBpm(parseInt(e.target.value), true));
        this.timeSignatureSelect.addEventListener('change', e => { this.timeSignature = e.target.value; this.saveSettings(); });
        this.subdivisionSelect.addEventListener('change', e => { this.subdivision = parseInt(e.target.value); this.saveSettings(); });
        document.getElementById('strumPatternSelect').addEventListener('change', e => { this.strumPattern = e.target.value; this.updateVisualIndicator(); });
        this.playBtn.addEventListener('click', () => this.togglePlay());
        document.getElementById('tapTempoBtn').addEventListener('click', () => this.handleTap());
    }
    setBpm(newBpm, save = false) {
        this.bpm = newBpm;
        this.bpmDisplay.textContent = this.bpm;
        this.bpmSlider.value = this.bpm;
        if(save) this.saveSettings();
    }
    loadSettings() {
        const settings = JSON.parse(localStorage.getItem('gwt-metro-settings'));
        if (settings) {
            this.setBpm(settings.bpm || 120);
            this.timeSignature = settings.timeSignature || '4/4';
            this.subdivision = settings.subdivision || 1;
        }
        document.getElementById('timeSignature').value = this.timeSignature;
        document.getElementById('subdivisionSelect').value = this.subdivision;
    }
    saveSettings() {
        const settings = { bpm: this.bpm, timeSignature: this.timeSignature, subdivision: this.subdivision };
        localStorage.setItem('gwt-metro-settings', JSON.stringify(settings));
    }
    togglePlay() { this.isPlaying ? this.stop() : this.start(); }
    handleTap() {
        const now = Date.now();
        if (this.tapTimes.length > 0 && (now - this.tapTimes[this.tapTimes.length - 1] > 2000)) this.tapTimes = [];
        this.tapTimes.push(now);
        if (this.tapTimes.length > 3) this.tapTimes.shift();
        if (this.tapTimes.length > 1) {
            const avg = (this.tapTimes[this.tapTimes.length - 1] - this.tapTimes[0]) / (this.tapTimes.length - 1);
            const newBpm = Math.round(60000 / avg);
            if (newBpm >= 40 && newBpm <= 240) this.setBpm(newBpm, true);
        }
    }
    updateVisualIndicator() {
        const indicator = document.getElementById('visualIndicator');
        if (this.strumPattern) {
            indicator.innerHTML = `<div class="strum-arrow down"></div>`;
            indicator.style.borderRadius = '8px';
            indicator.style.borderStyle = 'dashed';
        } else {
            indicator.innerHTML = '';
            indicator.style.borderRadius = '50%';
            indicator.style.borderStyle = 'solid';
        }
    }
    start() {
        if (!this.audioContext) this.audioContext = new (window.AudioContext || window.webkitAudioContext)();
        this.isPlaying = true;
        this.currentBeat = 0; this.currentSubdivision = 0;
        this.nextNoteTime = this.audioContext.currentTime;
        this.scheduler();
        this.playBtn.innerHTML = '⏸️ Pausar'; this.playBtn.classList.add('playing');
    }
    stop() {
        this.isPlaying = false;
        clearTimeout(this.timerID);
        this.playBtn.innerHTML = '▶️ Iniciar'; this.playBtn.classList.remove('playing');
        document.getElementById('visualIndicator').classList.remove('beat');
    }
    scheduler() {
        while (this.nextNoteTime < this.audioContext.currentTime + this.scheduleAheadTime) {
            this.scheduleNote(this.nextNoteTime);
            this.nextNote();
        }
        if (this.isPlaying) this.timerID = setTimeout(() => this.scheduler(), this.lookahead);
    }
    scheduleNote(time) {
        const isMainBeat = this.currentSubdivision === 0;
        const isFirstBeat = this.currentBeat === 0 && isMainBeat;
        const osc = this.audioContext.createOscillator();
        const gain = this.audioContext.createGain();
        osc.connect(gain);
        gain.connect(this.audioContext.destination);
        osc.frequency.value = isFirstBeat ? 1000 : (isMainBeat ? 800 : 400);
        gain.gain.setValueAtTime(isMainBeat ? 0.1 : 0.05, time);
        osc.type = 'square';
        gain.gain.exponentialRampToValueAtTime(0.001, time + 0.05);
        osc.start(time);
        osc.stop(time + 0.1);
        setTimeout(() => this.showVisualBeat(isMainBeat), (time - this.audioContext.currentTime) * 1000);
    }
    showVisualBeat(isMainBeat) {
        const indicator = document.getElementById('visualIndicator');
        if (this.strumPattern && isMainBeat) {
            const pattern = this.strumPatterns[this.strumPattern];
            const arrowEl = indicator.querySelector('.strum-arrow');
            if (arrowEl) {
                const direction = pattern[this.currentBeat % pattern.length];
                arrowEl.className = `strum-arrow ${direction === '↓' ? 'down' : 'up'}`;
                arrowEl.classList.add('active');
                setTimeout(() => arrowEl.classList.remove('active'), 100);
            }
        } else if (isMainBeat) {
            indicator.classList.add('beat');
            setTimeout(() => indicator.classList.remove('beat'), 100);
        }
    }
    nextNote() {
        const secondsPerSubdivision = (60.0 / this.bpm) / this.subdivision;
        this.nextNoteTime += secondsPerSubdivision;
        this.currentSubdivision = (this.currentSubdivision + 1) % this.subdivision;
        if (this.currentSubdivision === 0) {
            const beatsPerMeasure = parseInt(this.timeSignature.split('/')[0]);
            this.currentBeat = (this.currentBeat + 1) % beatsPerMeasure;
        }
    }
}

// =================================================================================
// ENTRENADOR DE OÍDO MUSICAL
// =================================================================================
class EarTraining {
    constructor() {
        this.audioContext = null; this.currentInterval = null; this.currentChord = null; this.currentProgression = null; this.selectedInstrument = 'piano';
        this.intervals = [{ name: 'Unísono', semitones: 0 },{ name: '2ª menor', semitones: 1 },{ name: '2ª mayor', semitones: 2 },{ name: '3ª menor', semitones: 3 },{ name: '3ª mayor', semitones: 4 },{ name: '4ª justa', semitones: 5 },{ name: 'Tritono', semitones: 6 },{ name: '5ª justa', semitones: 7 },{ name: '6ª menor', semitones: 8 },{ name: '6ª mayor', semitones: 9 },{ name: '7ª menor', semitones: 10 },{ name: '7ª mayor', semitones: 11 },{ name: 'Octava', semitones: 12 }];
        this.chords = [{ name: 'Mayor', intervals: [0, 4, 7] },{ name: 'menor', intervals: [0, 3, 7] },{ name: 'Aumentado', intervals: [0, 4, 8] },{ name: 'Disminuido', intervals: [0, 3, 6] },{ name: 'Mayor 7', intervals: [0, 4, 7, 11] },{ name: 'menor 7', intervals: [0, 3, 7, 10] },{ name: 'Dominante 7', intervals: [0, 4, 7, 10] }];
        this.progressions = [{ name: 'I-V-vi-IV', chords: ['C', 'G', 'Am', 'F'] },{ name: 'vi-IV-I-V', chords: ['Am', 'F', 'C', 'G'] },{ name: 'I-vi-IV-V', chords: ['C', 'Am', 'F', 'G'] },{ name: 'ii-V-I', chords: ['Dm', 'G', 'C'] }];
        this.setupControls();
    }
    setupControls() {
        document.getElementById('instrumentSelect').addEventListener('change', e => this.selectedInstrument = e.target.value);
        document.querySelectorAll('#ear-training .tab').forEach(tab => tab.addEventListener('click', e => this.showTab(e.target.dataset.tab)));
        document.getElementById('newInterval').addEventListener('click', () => this.playNewInterval());
        document.getElementById('repeatInterval').addEventListener('click', () => this.repeatCurrentInterval());
        document.getElementById('newChord').addEventListener('click', () => this.playNewChord());
        document.getElementById('repeatChord').addEventListener('click', () => this.repeatCurrentChord());
        document.getElementById('newProgression').addEventListener('click', () => this.playNewProgression());
        document.getElementById('repeatProgression').addEventListener('click', () => this.repeatCurrentProgression());
    }
    showTab(tabId) {
        document.querySelectorAll('#ear-training .tab-content').forEach(content => content.classList.remove('active'));
        document.querySelectorAll('#ear-training .tab').forEach(tab => tab.classList.remove('active'));
        document.getElementById(tabId).classList.add('active');
        document.querySelector(`#ear-training .tab[data-tab="${tabId}"]`).classList.add('active');
    }
    initAudioContext() { if (!this.audioContext) this.audioContext = new (window.AudioContext || window.webkitAudioContext)(); }
    playNewInterval() {
        this.initAudioContext();
        this.currentInterval = this.intervals[Math.floor(Math.random() * this.intervals.length)];
        this.playInterval(this.currentInterval.semitones);
        document.getElementById('intervalResult').textContent = '🎵 Escucha el intervalo...';
        this.showOptions('interval', this.intervals, this.currentInterval);
    }
    repeatCurrentInterval() { if (this.currentInterval) this.playInterval(this.currentInterval.semitones); }
    playNewChord() {
        this.initAudioContext();
        this.currentChord = this.chords[Math.floor(Math.random() * this.chords.length)];
        this.playChord(this.currentChord.intervals);
        document.getElementById('chordResult').textContent = '🎹 Escucha el acorde...';
        this.showOptions('chord', this.chords, this.currentChord);
    }
    repeatCurrentChord() { if (this.currentChord) this.playChord(this.currentChord.intervals); }
    playNewProgression() {
        this.initAudioContext();
        this.currentProgression = this.progressions[Math.floor(Math.random() * this.progressions.length)];
        this.playProgression(this.currentProgression.chords);
        document.getElementById('progressionResult').textContent = '🎼 Escucha la progresión...';
        this.showOptions('progression', this.progressions, this.currentProgression);
    }
    repeatCurrentProgression() { if (this.currentProgression) this.playProgression(this.currentProgression.chords); }
    
    showOptions(type, optionsArray, correctOption) {
        const container = document.getElementById(`${type}Options`);
        container.innerHTML = ''; container.style.display = 'block';
        const options = this.generateRandomOptions(optionsArray, correctOption, 4);
        options.forEach(option => {
            const btn = document.createElement('button');
            btn.className = 'exercise-btn button';
            btn.textContent = type === 'chord' ? `Acorde ${option.name}` : option.name;
            btn.addEventListener('click', () => this.checkAnswer(type, option, btn, correctOption));
            container.appendChild(btn);
        });
    }

    checkAnswer(type, selectedOption, button, correctOption) {
        const isCorrect = selectedOption.name === correctOption.name;
        const resultDiv = document.getElementById(`${type}Result`);
        const optionsContainer = document.getElementById(`${type}Options`);
        button.classList.add(isCorrect ? 'correct' : 'incorrect');
        resultDiv.style.color = `var(--${isCorrect ? 'success' : 'error'}-color)`;
        if (isCorrect) {
            resultDiv.textContent = `✅ ¡Correcto! ${correctOption.name}`;
        } else {
            resultDiv.textContent = `❌ Incorrecto. Era: ${correctOption.name}`;
            optionsContainer.querySelectorAll('.exercise-btn').forEach(btn => {
                if (btn.textContent.includes(correctOption.name)) btn.classList.add('correct');
            });
        }
        setTimeout(() => {
            optionsContainer.style.display = 'none';
            resultDiv.textContent = '';
        }, 3000);
    }

    playInterval(semitones) {
        const baseFreq = 261.63; // C4
        this.playTone(baseFreq, 0, 1);
        setTimeout(() => this.playTone(baseFreq * Math.pow(2, semitones / 12), 0, 1), 800);
    }
    playChord(intervals) {
        const baseFreq = this.selectedInstrument === 'bass' ? 130.81 : 261.63;
        intervals.forEach(interval => this.playTone(baseFreq * Math.pow(2, interval / 12), 0, 2));
    }
    playProgression(chordNames) {
        const chordMap = { 'C': [0, 4, 7], 'Dm': [2, 5, 9], 'F': [5, 9, 12], 'G': [7, 11, 14], 'Am': [9, 12, 16] };
        chordNames.forEach((chordName, index) => {
            setTimeout(() => this.playChord(chordMap[chordName] || [0, 4, 7]), index * 1200);
        });
    }
    generateRandomOptions(array, correct, count) {
        const options = [correct];
        const remaining = array.filter(item => item.name !== correct.name);
        while (options.length < count && remaining.length > 0) {
            const randomIndex = Math.floor(Math.random() * remaining.length);
            options.push(remaining.splice(randomIndex, 1)[0]);
        }
        return options.sort(() => Math.random() - 0.5);
    }
    
    playTone(frequency, delay = 0, duration = 1) {
        this.initAudioContext();
        const startTime = this.audioContext.currentTime + delay;
        const osc = this.audioContext.createOscillator();
        const gainNode = this.audioContext.createGain();
        osc.connect(gainNode);
        gainNode.connect(this.audioContext.destination);
        osc.frequency.value = frequency;
        switch (this.selectedInstrument) {
            case 'piano':
                osc.type = 'triangle';
                gainNode.gain.setValueAtTime(0, startTime);
                gainNode.gain.linearRampToValueAtTime(0.4, startTime + 0.05);
                gainNode.gain.exponentialRampToValueAtTime(0.01, startTime + duration);
                break;
            case 'guitar':
                osc.type = 'sawtooth';
                gainNode.gain.setValueAtTime(0, startTime);
                gainNode.gain.linearRampToValueAtTime(0.3, startTime + 0.02);
                gainNode.gain.exponentialRampToValueAtTime(0.001, startTime + duration);
                break;
            case 'bass':
                osc.type = 'sine';
                gainNode.gain.setValueAtTime(0, startTime);
                gainNode.gain.linearRampToValueAtTime(0.5, startTime + 0.05);
                gainNode.gain.linearRampToValueAtTime(0, startTime + duration);
                break;
        }
        osc.start(startTime);
        osc.stop(startTime + duration);
    }

    triggerNewExercise() {
        const activeTab = document.querySelector('#ear-training .tab.active').dataset.tab;
        document.getElementById(`new${activeTab.charAt(0).toUpperCase() + activeTab.slice(1, -1)}`).click();
    }
    triggerRepeatExercise() {
        const activeTab = document.querySelector('#ear-training .tab.active').dataset.tab;
        document.getElementById(`repeat${activeTab.charAt(0).toUpperCase() + activeTab.slice(1, -1)}`).click();
    }
}


// =================================================================================
// GESTOR DE CANCIONES PRO
// =================================================================================
class SongManager {
    constructor(earTrainingInstance) {
        this.songs = []; this.currentSong = null; this.currentTransposition = 0;
        this.earTraining = earTrainingInstance;
        this.tooltip = document.getElementById('chordTooltip');
        this.chordDiagrams = {
            'C': { frets: ['x', 3, 2, 0, 1, 0] }, 'G': { frets: [3, 2, 0, 0, 0, 3] }, 'D': { frets: ['x', 'x', 0, 2, 3, 2] }, 'A': { frets: ['x', 0, 2, 2, 2, 0] }, 'E': { frets: [0, 2, 2, 1, 0, 0] },
            'Am': { frets: ['x', 0, 2, 2, 1, 0] }, 'Em': { frets: [0, 2, 2, 0, 0, 0] }, 'Dm': { frets: ['x', 'x', 0, 2, 3, 1] },
            'F': { frets: [1, 3, 3, 2, 1, 1], barre: 1 }, // Barre chord
            'C7': { frets: ['x', 3, 2, 3, 1, 0] }, 'G7': { frets: [3, 2, 0, 0, 0, 1] }, 'D7': { frets: ['x', 'x', 0, 2, 1, 2] }, 'A7': { frets: ['x', 0, 2, 0, 2, 0] }, 'E7': { frets: [0, 2, 0, 1, 0, 0] }, 'B7': { frets: ['x', 2, 1, 2, 0, 2] }
        };
        this.loopingSection = -1;
        this.setupControls(); this.loadSongs();
    }
    setupControls() {
        document.getElementById('songSelect').addEventListener('change', e => this.selectSong(e.target.value));
        document.getElementById('deleteSongBtn').addEventListener('click', () => this.deleteSong());
        document.getElementById('transposeUp').addEventListener('click', () => this.transposeSong(1));
        document.getElementById('transposeDown').addEventListener('click', () => this.transposeSong(-1));
        document.getElementById('importSongsBtn').addEventListener('click', () => document.getElementById('fileInput').click());
        document.getElementById('exportSongsBtn').addEventListener('click', () => this.exportSongs());
        document.getElementById('fileInput').addEventListener('change', e => this.importSongs(e));
        document.getElementById('addSongBtn').addEventListener('click', () => alert("Para añadir una canción, puedes exportar la lista, editar el archivo JSON y volver a importarlo."));
    }
    loadSongs() {
        const saved = localStorage.getItem('gwt-songs');
        this.songs = saved ? JSON.parse(saved) : [];
        if (this.songs.length === 0) this.loadExampleSong();
        this.updateSongSelect();
        this.selectSong(this.songs[0]?.id);
    }
    loadExampleSong() {
        const exampleSong = {
            id: 'example-1', title: 'Sublime Gracia', artist: 'John Newton (Arr. Sencillo)',
            structure: [
                { name: 'Verso 1', chords: ['G', 'C', 'G', 'G', 'G', 'G', 'D', 'D'] },
                { name: 'Verso 2', chords: ['G', 'C', 'G', 'G', 'G', 'D', 'G', 'G'] }
            ]
        };
        this.songs.push(exampleSong);
        this.saveSongs();
    }
    saveSongs() { localStorage.setItem('gwt-songs', JSON.stringify(this.songs)); }

    selectSong(id) {
        this.currentSong = this.songs.find(s => s.id === id);
        this.currentTransposition = 0;
        this.toggleDisplay();
        if(this.currentSong) {
            document.getElementById('songSelect').value = id;
            this.displaySong();
        }
    }

    toggleDisplay() {
        const hasSongs = this.songs.length > 0;
        document.getElementById('songEmptyState').style.display = hasSongs ? 'none' : 'block';
        document.getElementById('songDisplay').style.display = this.currentSong ? 'block' : 'none';
        document.getElementById('deleteSongBtn').style.display = this.currentSong ? 'inline-flex' : 'none';
        document.getElementById('exportSongsBtn').style.display = hasSongs ? 'inline-flex' : 'none';
    }

    displaySong() {
        if (!this.currentSong) return;
        document.getElementById('currentSongTitle').textContent = this.currentSong.title;
        document.getElementById('currentSongArtist').textContent = this.currentSong.artist;
        const structureContainer = document.getElementById('songStructure');
        structureContainer.innerHTML = '';
        
        this.currentSong.structure.forEach((section, sectionIndex) => {
            const sectionTitleDiv = document.createElement('div');
            sectionTitleDiv.className = 'section-title';

            const sectionNameSpan = document.createElement('span');
            sectionNameSpan.textContent = `[${section.name}]`;
            sectionTitleDiv.appendChild(sectionNameSpan);

            const loopBtn = document.createElement('span');
            loopBtn.className = 'section-loop-btn';
            loopBtn.textContent = '⟲';
            loopBtn.title = 'Repetir esta sección';
            loopBtn.onclick = () => alert("Looping: ¡Próximamente!");
            sectionTitleDiv.appendChild(loopBtn);

            const chordsDiv = document.createElement('div');
            const transposedChords = section.chords.map(chord => this.transposeChord(chord, this.currentTransposition));
            transposedChords.forEach((chord, i) => {
                const chordSpan = document.createElement('span');
                chordSpan.className = 'chord';
                chordSpan.textContent = chord;
                chordSpan.addEventListener('mouseenter', e => this.showChordTooltip(e, chord));
                chordSpan.addEventListener('mouseleave', () => this.hideChordTooltip());
                chordsDiv.appendChild(chordSpan);
                if(i < transposedChords.length - 1) chordsDiv.append(' | ');
            });

            structureContainer.appendChild(sectionTitleDiv);
            structureContainer.appendChild(chordsDiv);
            if(sectionIndex < this.currentSong.structure.length - 1) structureContainer.append(document.createElement('br'));
        });
    }

    showChordTooltip(event, chordName) {
        const diagram = this.chordDiagrams[chordName.split('/')[0].trim()]; // Handle slash chords
        if (!diagram) return;

        this.tooltip.innerHTML = this._createTooltipFretboardHTML(chordName, diagram);
        this.tooltip.style.left = `${event.pageX + 15}px`;
        this.tooltip.style.top = `${event.pageY + 15}px`;
        this.tooltip.classList.add('visible');
    }

    hideChordTooltip() { this.tooltip.classList.remove('visible'); }
    
    _createTooltipFretboardHTML(name, diagram) {
        let html = `<div class="fretboard-tooltip"><div class="chord-name">${name}</div>`;
        const frets = diagram.frets;
        const stringPositions = [5, 15, 25, 35, 45, 55]; // in px

        // Open/Muted strings
        let topRow = '';
        frets.forEach((f, i) => {
            const pos = stringPositions[i];
            if (f === 'o' || f === 0) topRow += `<div class="open-string-tooltip" style="left: ${pos}px;"></div>`;
            if (f === 'x') topRow += `<div class="muted-string-tooltip" style="left: ${pos}px;">×</div>`;
        });
        html += `<div style="position: relative; height: 10px;">${topRow}</div>`;

        // Frets
        for (let fret = 1; fret <= 4; fret++) {
            html += '<div class="fret-tooltip">';
            // Strings
            stringPositions.forEach(pos => html += `<div class="string-tooltip" style="left: ${pos}px; height: 10px;"></div>`);
            // Fingers
            frets.forEach((f, stringIndex) => {
                if(f === fret) html += `<div class="finger-tooltip" style="left: ${stringPositions[stringIndex]}px; top: 50%;"></div>`;
            });
            html += '</div>';
        }
        return html + '</div>';
    }

    deleteSong() { /* ... */ }
    transposeSong(steps) { /* ... */ }
    transposeChord(chord, steps) { /* ... */ }
    updateSongSelect() { /* ... */ }
    exportSongs() { /* ... */ }
    importSongs(event) { /* ... */ }
}

// =================================================================================
// VISUALIZADOR DE ESCALAS
// =================================================================================
class ScaleVisualizer {
    // ... Código completo de ScaleVisualizer ...
}

// =================================================================================
// JUEGO DE MEMORIA MUSICAL
// =================================================================================
class MemoryGame {
    // ... Código completo de MemoryGame ...
}

// Inicializar la aplicación
document.addEventListener('DOMContentLoaded', () => {
    window.app = new GuitarWorshipTrainer();
});
</script>
</body>
</html>